# Калькулятор Qt QML

## Описание

Программа представляет собой аналог простого калькулятора Windows.  
Вычисления выполняются **слева направо**, **без приоритета операций**.
Поддерживаемые операции: "+", "-", "/", "*".
Исключения и ошибки при работе программы выводятся на **Экран консоли**.

Калькулятор поддерживает два режима:
- **Встроенный режим** — вычисления производятся с помощью внутреннего метода класса.
- **Внешний режим**    — вычисления делегируются внешней динамической библиотеке с функцией.

Переключение режимов работы осуществляется кнопкой (Номер кнопки) на дисплее калькулятора. В случае, если библиотеку не удалось загрузить, то, в не зависимости от выбранного режима, вычисления будут происходить во **Встроенном режиме**.

В калькуляторе присутствуют следующие элементы управления и отображения:
- **Консоль (1)** — осуществялет вывод информации об ошибках **КРАСНЫЙ ЦВЕТ**, введенное выражение **СИНИЙ ЦВЕТ** и результат вычисления выражения **ЗЕЛЕНЫЙ ЦВЕТ**.
- **Дисплей (2)** — осуществляет вывод вводимого выражения **ЧЕРНЫЙ ЦВЕТ**, а также содержит некоторые элементы управления:
    - **Панель изменения задержки вычислений (4)** — изменяет в пределах от 0.0 до 10.0 с шагом 0.5 задержку вычисления вводимого выражения. Изменение осуществляется нажатием на кнопки вверх (**▲**)/вниз (**▼**), либо прокруткой колесика мыши на области панели.
    - **Счетчик запросов (5)** — выводит количество запросов на вычисления в очереди.
    - **Счетчик ответов (6)** — выводит количество ответов с результатами вычислений в очереди.
    - **Кнопка смены режима (7)** — по нажатию меняется режим вычисления, режим подписан на самой кнопке: **Встроенный режим — FUNC** / **Внешний режим — DLL**. Режим по умолчанию — **Встроенный**.
    - **Кнопка вызова справки (8)** — открывает окно со справкой по нажатию.
- **NUMPAD (3)** — область с кнопками математических операций, цифр и управляющих символов. Поддерживает ввод по нажатию на кнопки, нажатию на клавиши NumPad и клавиши цифр. Поддерживаемые клавиши:
    - **Key_0 - Key_9** — ввод соответствующей цифры.
    - **Key_Numpad0 - KeyNumpad9** — ввод соответствующей цифры.
    - **Backspace**                — стирание последнего символа.
    - **Key_Plus**                 — оператор **+**.
    - **Key_Minus**                — оператор **-**.
    - **Key_Asterisk**             — оператор **\***.
    - **Key_Slash**                — оператор **/**.
    - **Key_Period**               — точка разделитель.
    - **Key_Enter**                — оператор **=**.
 
    Кнопки не имеющие клавиш:
    - **CE** — очистка консоли и дисплея.
    - **C**  — очистка дисплея. 
    - **±**  — смена знака у текущего числа на противоположный.

<img width="686" height="686" alt="Demo" src="https://github.com/user-attachments/assets/a75c1414-878e-4d67-8de5-b4090153ca7f" />

Примеры вычислений:
  - **1 + 1 * 5 + 3 / 10 = 1.3**
  - **5 + 2 * 10 = 70**
  - **5.5 * 10 + 10 / 5 = 13**
  - **2.2 * 1.8 = 3.96**
  - **10 / 9 = 1.11111**
      
## Описание структуры программы и ее работы

Программа построена на архитектуре MVC и предоставляет собой 3 основных класса:
- **Controller**          — Класс-контроллер, реализует управление очередями и передачу данных между представлением и моделями.
- **MainWindow**          — Класс-представление, содержит qml движок и производит его загрузку, производит регистрацию пользовательских типов в системе Qt и управляет приемом и передачей данных с/на формы QML.
- **ExpressionProcessor** — Класс-модель, производит парсинг и вычсиление выражений, осущесвляет загрузку внешней библиотеки.

Прочие классы:
- **AppConfig**               — осущесвляет чтение/запись в файл геометрии окна.
- **ThreadSafeQQueue**        — обертка над **QQueue** с потокобезопасным доступом.
- **ExpressionModuleFactory** — фабрика для удобного создания и подключения новой модели **ExpressionProcessor**. Создает модель и поток, осуществляет перемещение модели в новый поток и его запуск, подключает необходимые для корректной работы сигналы/слоты к переданному контроллеру.

**Краткое описание запуска одного расчета:**
&nbsp;&nbsp;&nbsp;&nbsp;Вводимое через клавиши или посредством кнопок выражение, после нажатия кнопки "=" или соответствующей клавиши, удаляетя с **элемента дисплея** и отправляется в **элемент консоли**, а затем формируется запрос, содержащий само выражение и указанную задержку вычисления, которое передается в класс **MainWindow**. 
**MainWindow** отправляет запрос **контроллеру**, который помещает его в очередь и уведомляет **модели**, о том, что в очередь поступил запрос. **Модели/Модель** запускает метод обработки выражения, который извлекает элемент из очереди, если он там присутствует, и вычисляет его одним из способов: 
**double DoIt(int TypeWork, double OperandA, double OperandB)** — своим методом, в случае, если задан **Встроенный режим** или **double externalDoItFunc(int TypeWork, double OperandA, double OperandB)**, если задан **Внешний режим**. Результат, каким бы он не был, передается **контроллеру**, 
который помещает его в очередь ответов и уведомляет об этом **MainWindow**. **MainWindow** извлекает ответ и выводит его на **элемент консоли**.

  
